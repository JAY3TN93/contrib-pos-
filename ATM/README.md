# ATM Driver
The ATM driver is an application that has been designed and developed to drive Automated Teller Machines(ATM terminals) and Bulk Note Acceptors( Cash Deposit terminals). The driver supports NDC, NDC+, AptraEdge protocols along with ISO 8583 and ISO JSON messaging formats.
The driver has been designed to integrate with any type of payments switch for ATM driving, managing and monitoring.

## Use Case: ATM Initiated Cash Out

The ATM driver has been customised to integrate with Mojaloop to support the 'ATM Initiated Cash Out' scenario. 

This use case involves two parties: ATM and Customer. ATM initiates a Cash-Out request from the customer account and the customer confirms the request by providing authentication (OTP) on ATM. The customer pre-generates an OTP for cash-out and uses this OTP on ATM device to initiate ATM Cash-out. The Payer FSP validates the OTP received in ATM-Initiated Cash-Out request for the validity of OTP as well as for authentication. If the customer authentication via OTP is successful; then the customer’s account will be debited at Payer FSP and ATM account maintained at Payee FSP will be credited. As a result, the customer receives cash from ATM.

### Transaction flow

Firstly, customer will have to generate OTP through mobile application for desired ATM Initiated Cash-out amount. This OTP will be sent to customer’s mobile number. 
We intend to use the FSP simulator to simulate the Payer and Payee FSP's. An endpoint to generate and validate OTP will be implemented on the Simulator. The ATM/POS driver would be responsible for the conversion of ISO to Open API

  - Customer generates an OTP before initiating the transaction request from ATM.
  - The customer initiates withdrawal transaction on the ATM by entering their account ID and amount. 
  - Cash Out Request will be generated by ATM Driver in NDC protocol. This will be converted to OPEN API call and will be sent to Mojaloop.
  - Mojaloop will perform Account lookup and the transaction request will be sent to Payer FSP for authentication.
  - The Payer FSP validates the transaction request and also calculate the Quote for the transaction.
  - The calculated Quote will be displayed on the Terminal for confirmation by the Payee.
  - The Customer will authenticate the transaction by entering pre-generated OTP.
  - Payer FSP will authenticate the OTP. 
  - If successful, the customer’s account will be debited, and the ATM account maintained by Payee FSP will be credited.
  - Payer FSP will send response back to Mojaloop.
  - Response will be received by ATM Driver in OPEN API. This will be converted to ISO and is sent to ATM.
  - ATM will perform the actions as mentioned by the message. (Dispense and Print etc.)
  
  ## Pre-requisite Software stack
  
  The following platforms are supported by ATM Driver. 
  
 - Operating System [Windows (any edition), Linux, and iOS].
 - Database (MSSQL Server, Postgresql, MySQL, SQLite etc.). 

The following software should be installed on the system.

- Java version 8 should be installed on the server.
- Apache Tomcat version 8.5 should be installed (For UI deployment)
- Google Chrome for configuration UI 

## Mojaloop Integration

ATM Driver application will drive the ATM by sending the machine with the required states and screens. The machine will only perform according to the download (Includes - State, Screen, FIT, Options and Timers and other download related config) which is sent to the machine from the driver application. The applciation provides the necessary options to conifgure the states, screens and download through the user interface.

For Mojaloop integration, the ATM Driver will be configured with additional State and Screens for integrating the below functions on to the ATM.



	state-D
State - 			State - 			State - 		State - 

The transaction request will be sent to Mojaloop ATM endpoint in ISO format by the driver. The request will contain the phone number and OTP entered by the payer in general buffer b and c. This can be picked up and send forward in the required format and field so as to process.

- State E - will be having options to select - 1)Normal ATM Transaction 2) Mojaloop Transaction
- State H  - will have information entry screen to enter Phone number
- State H  - will have information entry screen to enter OTP
- State D -  will adjust the Opcode generated by the ATM
- State I -  will sent the transaction request to the Driver.


